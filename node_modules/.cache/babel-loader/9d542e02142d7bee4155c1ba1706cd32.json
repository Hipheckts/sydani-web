{"ast":null,"code":"import React, { Component } from \"react\";\nimport Header from \"./common/Header\";\nimport { Link } from \"react-router-dom\";\nimport Footer from \"./common/Footer\";\nimport html2canvas from 'html2canvas';\nimport { jsPDF } from \"jspdf\";\nimport NumberFormat from \"react-number-format\";\nimport { PaystackConsumer } from \"react-paystack\";\nimport $ from \"jquery\";\nimport ScriptTag from \"react-script-tag\";\nimport AOS from \"aos\";\nimport QRCode from \"qrcode.react\";\nimport axios from \"axios\";\nimport swal from \"sweetalert\";\nimport Avatar from \"./assets/img/default-user-avatar.png\";\n\nvar _membership;\n\nexport class Dashboard extends Component {\n  constructor(props) {\n    super(props);\n\n    this.export = (type, name) => {\n      html2canvas(document.querySelector(\"#capture\")).then(canvas => {\n        let dataURL = canvas.toDataURL('image/png');\n\n        if (type === 'pdf') {\n          const pdf = new jsPDF({\n            orientation: \"landscape\",\n            unit: \"in\",\n            format: [14, 10]\n          });\n          pdf.addImage(dataURL, 'PNG', .6, .6);\n          pdf.save(`${name}.pdf`);\n        } else if (type === 'png') {\n          var link = document.createElement('a');\n          link.download = `${name}.png`;\n          link.href = dataURL;\n          link.click();\n        }\n      });\n    };\n\n    this.selectMembership = () => {\n      this.setState({\n        planAmount: document.querySelector(\"#membership-select\").value\n      }); // console.log(this.state.planAmount);\n    };\n\n    this.state = {\n      token: localStorage[\"appState\"] ? JSON.parse(localStorage[\"appState\"]).user.token : \"\",\n      user: [],\n      isLoading: true,\n      planAmount: \"0\"\n    };\n    AOS.init();\n  }\n\n  componentDidMount() {\n    axios.get(`${axios.defaults.baseURL}/user/${JSON.parse(localStorage[\"appState\"]).user.id}`, {\n      headers: {\n        Authorization: `Bearer ${this.state.token}`\n      }\n    }).then(response => {\n      //console.log(response);\n      return response;\n    }).then(json => {\n      if (json.data.success) {\n        this.setState({\n          user: json.data.user[0],\n          isLoading: false\n        }); // } else alert(\"Cannot Fetch Data!\");\n      } else swal(\"Oops!\", \"Cannot Fetch Data!\", \"error\");\n    }).catch(error => {\n      console.error(`An Error Occured! ${error}`);\n    }); // alert(id)\n  }\n\n  render() {\n    const configNGN = {\n      // reference: (new Date()).getTime(),\n      // email: \"hipheckt@gmail.com\",\n      email: this.state.user.email,\n      // plan: this.state.plan,\n      amount: this.state.planAmount + \"00\",\n      currency: \"NGN\",\n      // publicKey: 'pk_live_68d2b6e9edacd11392f5548db9047ffb4911b39d',\n      publicKey: \"pk_test_a842c66ae323671a5e629e8970958560b65d3ad6\"\n    };\n    const componentPropsNGN = { ...configNGN,\n      text: \"Sapio Sibling Membership Fee\",\n      onSuccess: response => {\n        // console.log(response);\n        $(\"#reg-button\").attr(\"disabled\", \"disabled\").html('<i class=\"fa fa-spinner fa-spin fa-1x fa-fw\"></i><span class=\"sr-only\">Initiating Payment...</span>');\n        this.setState({\n          payment_ref: response.trxref\n        });\n        axios({\n          method: \"get\",\n          url: `https://api.paystack.co/transaction/verify/${this.state.payment_ref}`,\n          // headers: {'Authorization': `Bearer sk_live_5299c2d2e25663425657490251d1cec7d8c206aa`, 'Content-Type': 'application/json' }\n          headers: {\n            Authorization: `Bearer sk_test_b921c5ae7960bc5df7b895cad6b1f37ce0b29b73`,\n            \"Content-Type\": \"application/json\"\n          }\n        }).then(response => {\n          console.log(response);\n          return response;\n        }).then(json => {\n          this.setState({\n            auth_code: json.data.data.authorization.authorization_code\n          }); // swal(\n          //   \"Success!\",\n          //   this.state.auth_code,\n          //   \"success\",\n          //   {\n          //     button: false,\n          //     // timer: 1500,\n          //   }\n          // );\n\n          var formData = new FormData();\n          formData.append(\"email\", this.state.user.email);\n          formData.append(\"auth_code\", this.state.auth_code);\n          formData.append(\"membership\", _membership.value);\n          axios.post(`${axios.defaults.baseURL}/pay-user`, formData).then(response => {\n            //console.log(response);\n            return response;\n          }).then(json => {\n            if (json.data.success) {\n              // alert(`Registration Successful!`);\n              swal(\"Success!\", json.data.message, \"success\", {\n                button: false,\n                timer: 1500\n              }); // redirect home\n\n              this.props.history.push(\"/dashboard\");\n            } else {\n              // alert(`Registration Failed!`);\n              swal(\"Failed\", \"Payment Failed\", \"error\");\n            }\n          }).catch(error => {\n            swal(\"Error!\", \"An Error Occured!\", \"error\", {\n              button: false // timer: 1500\n\n            });\n          });\n        });\n      },\n      onClose: () => null\n    };\n    return this.state.isLoading ? null( /*#__PURE__*/React.createElement(React.Fragment, null)) : null;\n  }\n\n}\nexport default Dashboard;","map":{"version":3,"sources":["/Users/hipheckt/codes/sapioservice/react/src/Dashboard.js"],"names":["React","Component","Header","Link","Footer","html2canvas","jsPDF","NumberFormat","PaystackConsumer","$","ScriptTag","AOS","QRCode","axios","swal","Avatar","_membership","Dashboard","constructor","props","export","type","name","document","querySelector","then","canvas","dataURL","toDataURL","pdf","orientation","unit","format","addImage","save","link","createElement","download","href","click","selectMembership","setState","planAmount","value","state","token","localStorage","JSON","parse","user","isLoading","init","componentDidMount","get","defaults","baseURL","id","headers","Authorization","response","json","data","success","catch","error","console","render","configNGN","email","amount","currency","publicKey","componentPropsNGN","text","onSuccess","attr","html","payment_ref","trxref","method","url","log","auth_code","authorization","authorization_code","formData","FormData","append","post","message","button","timer","history","push","onClose"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nimport Header from \"./common/Header\";\nimport { Link } from \"react-router-dom\";\nimport Footer from \"./common/Footer\";\n\nimport html2canvas from 'html2canvas'\nimport { jsPDF } from \"jspdf\";\n\nimport NumberFormat from \"react-number-format\";\nimport { PaystackConsumer } from \"react-paystack\";\nimport $ from \"jquery\";\n\nimport ScriptTag from \"react-script-tag\";\nimport AOS from \"aos\";\n\nimport QRCode from \"qrcode.react\";\n\nimport axios from \"axios\";\nimport swal from \"sweetalert\";\n\nimport Avatar from \"./assets/img/default-user-avatar.png\";\n\nvar _membership;\n\nexport class Dashboard extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      token: localStorage[\"appState\"]\n        ? JSON.parse(localStorage[\"appState\"]).user.token\n        : \"\",\n      user: [],\n      isLoading: true,\n      planAmount: \"0\",\n    };\n    AOS.init();\n  }\n\n  export = (type, name) => {\n    \n    html2canvas(document.querySelector(\"#capture\")).then(canvas => {\n      let dataURL = canvas.toDataURL('image/png');\n\n      if (type === 'pdf') {\n        const pdf = new jsPDF({\n          orientation: \"landscape\",\n          unit: \"in\",\n          format: [14, 10]\n        });\n\n        pdf.addImage(dataURL, 'PNG', .6, .6);\n        pdf.save(`${name}.pdf`);\n\n      } else if (type === 'png') {\n        var link = document.createElement('a');\n        link.download = `${name}.png`;\n        link.href = dataURL;\n        link.click();\n      }\n    });\n  }\n\n  componentDidMount() {\n    axios\n      .get(\n        `${axios.defaults.baseURL}/user/${\n          JSON.parse(localStorage[\"appState\"]).user.id\n        }`,\n        {\n          headers: {\n            Authorization: `Bearer ${this.state.token}`,\n          },\n        }\n      )\n      .then((response) => {\n        //console.log(response);\n        return response;\n      })\n      .then((json) => {\n        if (json.data.success) {\n          this.setState({\n            user: json.data.user[0],\n            isLoading: false\n          });\n          // } else alert(\"Cannot Fetch Data!\");\n        } else swal(\"Oops!\", \"Cannot Fetch Data!\", \"error\");\n      })\n      .catch((error) => {\n        console.error(`An Error Occured! ${error}`);\n      });\n    // alert(id)\n  }\n\n  selectMembership = () => {\n    this.setState({\n      planAmount: document.querySelector(\"#membership-select\").value\n    });\n    // console.log(this.state.planAmount);\n  };\n\n  render() {\n\n    const configNGN = {\n      // reference: (new Date()).getTime(),\n      // email: \"hipheckt@gmail.com\",\n      email: this.state.user.email,\n      // plan: this.state.plan,\n      amount: this.state.planAmount+\"00\",\n      currency: \"NGN\",\n      // publicKey: 'pk_live_68d2b6e9edacd11392f5548db9047ffb4911b39d',\n      publicKey: \"pk_test_a842c66ae323671a5e629e8970958560b65d3ad6\",\n    };\n\n    const componentPropsNGN = {\n      ...configNGN,\n      text: \"Sapio Sibling Membership Fee\",\n      onSuccess: (response) => {\n        // console.log(response);\n\n        $(\"#reg-button\")\n          .attr(\"disabled\", \"disabled\")\n          .html(\n            '<i class=\"fa fa-spinner fa-spin fa-1x fa-fw\"></i><span class=\"sr-only\">Initiating Payment...</span>'\n          );\n\n        this.setState({\n          payment_ref: response.trxref,\n        });\n\n        axios({\n          method: \"get\",\n          url: `https://api.paystack.co/transaction/verify/${this.state.payment_ref}`,\n          // headers: {'Authorization': `Bearer sk_live_5299c2d2e25663425657490251d1cec7d8c206aa`, 'Content-Type': 'application/json' }\n          headers: {\n            Authorization: `Bearer sk_test_b921c5ae7960bc5df7b895cad6b1f37ce0b29b73`,\n            \"Content-Type\": \"application/json\",\n          },\n        })\n          .then((response) => {\n            console.log(response);\n            return response;\n          })\n          .then((json) => {\n\n            this.setState({\n              auth_code: json.data.data.authorization.authorization_code,\n            });\n\n            // swal(\n            //   \"Success!\",\n            //   this.state.auth_code,\n            //   \"success\",\n            //   {\n            //     button: false,\n            //     // timer: 1500,\n            //   }\n            // );\n\n            var formData = new FormData();\n            formData.append(\"email\", this.state.user.email);\n            formData.append(\"auth_code\", this.state.auth_code);\n            formData.append(\"membership\", _membership.value);\n\n            axios\n              .post(`${axios.defaults.baseURL}/pay-user`, formData)\n              .then((response) => {\n                //console.log(response);\n                return response;\n              })\n              .then((json) => {\n                if (json.data.success) {\n                  // alert(`Registration Successful!`);\n                  swal(\"Success!\", json.data.message, \"success\", {\n                    button: false,\n                    timer: 1500,\n                  });\n                  // redirect home\n                  this.props.history.push(\"/dashboard\");\n                } else {\n                  // alert(`Registration Failed!`);\n                  swal(\"Failed\", \"Payment Failed\", \"error\");\n                }\n              })\n              .catch((error) => {\n                  swal(\"Error!\", \"An Error Occured!\", \"error\", {\n                  button: false,\n                  // timer: 1500\n                });\n              });\n          });\n      },\n      onClose: () => null,\n    };\n\n    return (\n      this.state.isLoading ? null (\n        <></>\n      ) : null\n    );\n  }\n}\n\nexport default Dashboard;\n"]},"metadata":{},"sourceType":"module"}